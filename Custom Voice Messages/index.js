(function(l,c,r,a,s,i,S,R,m,M){"use strict";function _(){const e=c.findByProps("uploadFiles");return e?r.before("uploadFiles",e,function(t){const n=t[1];!a.storage.sendAsVM||!n||n.forEach(function(o){(o.item?.mimeType?.startsWith("audio")||o.item?.filename?.endsWith(".mp3")||o.item?.filename?.endsWith(".ogg"))&&(o.item.flags=8192,o.item.waveform="AEtWPyUaGA4OEAcA",o.item.durationSecs=60,o.item.mimeType="audio/ogg")})}):function(){}}function v(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){a.storage.allAsVM&&e[0].messages.forEach(function(t){t.flags!=8192&&t.attachments.forEach(function(n){n.content_type?.startsWith?.("audio")&&(t.flags|=8192,n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60)})})})}function p(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}function w(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!a.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}const{FormRow:A}=m.Forms,f=c.findByProps("ActionSheetRow")?.ActionSheetRow;function g({label:e,icon:t,onPress:n}){const o=s.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:R.semanticColors.INTERACTIVE_NORMAL}});return f?React.createElement(f,{label:e,icon:React.createElement(f.Icon,{source:t,IconComponent:function(){return React.createElement(s.ReactNative.Image,{resizeMode:"cover",style:o.iconComponent,source:t})}}),onPress:function(){return n?.()}}):React.createElement(A,{label:e,leading:React.createElement(A.Icon,{source:t}),onPress:function(){return n?.()}})}const P=c.findByProps("openLazy","hideActionSheet");function V(){return r.before("openLazy",P,function(e){const[t,n,o]=e,u=o?.message;n!=="MessageLongPressActionSheet"||!u||t.then(function(B){const D=r.after("default",B,function(W,y){s.React.useEffect(function(){return function(){D()}},[]);const d=S.findInReactTree(y,function(U){return U?.[0]?.type?.name==="ButtonRow"});if(!d)return y;u.hasFlag(8192)&&(d.splice(5,0,s.React.createElement(g,{label:"Download Voice Message",icon:i.getAssetIDByName("ic_download_24px"),onPress:async function(){await c.findByProps("downloadMediaAsset").downloadMediaAsset(u.attachments[0].url,0),c.findByProps("hideActionSheet").hideActionSheet()}})),d.splice(6,0,s.React.createElement(g,{label:"Copy Voice Message URL",icon:i.getAssetIDByName("copy"),onPress:async function(){s.clipboard.setString(u.attachments[0].url),c.findByProps("hideActionSheet").hideActionSheet()}})))})})})}const{FormDivider:b,FormIcon:h,FormSwitchRow:E}=m.Forms;function C(){return M.useProxy(a.storage),React.createElement(s.ReactNative.ScrollView,null,React.createElement(E,{label:"Send audio files as Voice Message",leading:React.createElement(h,{source:i.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return a.storage.sendAsVM=e},value:a.storage.sendAsVM}),React.createElement(b,null),React.createElement(E,{label:"Show every audio file as a Voice Message",leading:React.createElement(h,{source:i.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return a.storage.allAsVM=e},value:a.storage.allAsVM}))}a.storage.sendAsVM??=!0,a.storage.allAsVM??=!1;const F=[_(),p(),v(),w(),V()],I=function(){F.forEach(function(e){return e()})};return l.onUnload=I,l.settings=C,l})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.ui,vendetta.ui.components,vendetta.storage);
