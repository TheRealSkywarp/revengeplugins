(function(u,c,i,o,s,r,R,M,A,_){"use strict";const{showToast:d}=c.findByProps("showToast");function v(){const e=c.findByProps("uploadFiles");return e?i.before("uploadFiles",e,function(t){const n=t[1];n&&d(`Upload detected: ${n.length} file(s)`),!(!o.storage.sendAsVM||!n)&&n.forEach(function(a){(a.item?.mimeType?.startsWith("audio")||a.item?.filename?.endsWith(".mp3")||a.item?.filename?.endsWith(".ogg")||a.item?.filename?.endsWith(".wav"))&&(d("Audio file detected! Patching..."),a.item.flags=8192,a.item.waveform="AEtWPyUaGA4OEAcA",a.item.durationSecs=60,a.item.mimeType="audio/ogg")})}):(d("ERROR: uploadFiles module not found!"),function(){})}function p(){return i.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){o.storage.allAsVM&&e[0].messages.forEach(function(t){t.flags!=8192&&t.attachments.forEach(function(n){n.content_type?.startsWith?.("audio")&&(t.flags|=8192,n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60)})})})}function w(){return i.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!o.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}function P(){return i.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!o.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}const{FormRow:g}=A.Forms,f=c.findByProps("ActionSheetRow")?.ActionSheetRow;function h({label:e,icon:t,onPress:n}){const a=s.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:M.semanticColors.INTERACTIVE_NORMAL}});return f?React.createElement(f,{label:e,icon:React.createElement(f.Icon,{source:t,IconComponent:function(){return React.createElement(s.ReactNative.Image,{resizeMode:"cover",style:a.iconComponent,source:t})}}),onPress:function(){return n?.()}}):React.createElement(g,{label:e,leading:React.createElement(g.Icon,{source:t}),onPress:function(){return n?.()}})}const V=c.findByProps("openLazy","hideActionSheet");function b(){return i.before("openLazy",V,function(e){const[t,n,a]=e,l=a?.message;n!=="MessageLongPressActionSheet"||!l||t.then(function(D){const U=i.after("default",D,function(O,S){s.React.useEffect(function(){return function(){U()}},[]);const m=R.findInReactTree(S,function(W){return W?.[0]?.type?.name==="ButtonRow"});if(!m)return S;l.hasFlag(8192)&&(m.splice(5,0,s.React.createElement(h,{label:"Download Voice Message",icon:r.getAssetIDByName("ic_download_24px"),onPress:async function(){await c.findByProps("downloadMediaAsset").downloadMediaAsset(l.attachments[0].url,0),c.findByProps("hideActionSheet").hideActionSheet()}})),m.splice(6,0,s.React.createElement(h,{label:"Copy Voice Message URL",icon:r.getAssetIDByName("copy"),onPress:async function(){s.clipboard.setString(l.attachments[0].url),c.findByProps("hideActionSheet").hideActionSheet()}})))})})})}const{FormDivider:C,FormIcon:E,FormSwitchRow:y}=A.Forms;function F(){return _.useProxy(o.storage),React.createElement(s.ReactNative.ScrollView,null,React.createElement(y,{label:"Send audio files as Voice Message",leading:React.createElement(E,{source:r.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return o.storage.sendAsVM=e},value:o.storage.sendAsVM}),React.createElement(C,null),React.createElement(y,{label:"Show every audio file as a Voice Message",leading:React.createElement(E,{source:r.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return o.storage.allAsVM=e},value:o.storage.allAsVM}))}o.storage.sendAsVM??=!0,o.storage.allAsVM??=!1;const B=[v(),w(),p(),P(),b()],I=function(){B.forEach(function(e){return e()})};return u.onUnload=I,u.settings=F,u})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.ui,vendetta.ui.components,vendetta.storage);
