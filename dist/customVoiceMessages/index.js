(function(u,i,r,o,s,l,S,R,m,M){"use strict";function _(){const e=i.findByProps("uploadFiles");return e?r.before("uploadFiles",e,function(t){const n=i.findByProps("showToast"),c=t[1];c&&n&&n.showToast(`Upload detected: ${c.length} file(s)`),!(!o.storage.sendAsVM||!c)&&c.forEach(function(a){(a.item?.mimeType?.startsWith("audio")||a.item?.filename?.endsWith(".mp3")||a.item?.filename?.endsWith(".ogg")||a.item?.filename?.endsWith(".wav"))&&(n&&n.showToast("Audio file detected! Patching..."),a.item.flags=8192,a.item.waveform="AEtWPyUaGA4OEAcA",a.item.durationSecs=60,a.item.mimeType="audio/ogg")})}):function(){}}function v(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("LOAD_MESSAGES_SUCCESS").find(function(e){return e.name==="MessageStore"}),function(e){o.storage.allAsVM&&e[0].messages.forEach(function(t){t.flags!=8192&&t.attachments.forEach(function(n){n.content_type?.startsWith?.("audio")&&(t.flags|=8192,n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60)})})})}function w(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_CREATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!o.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}function p(){return r.before("actionHandler",s.FluxDispatcher._actionHandlers._computeOrderedActionHandlers("MESSAGE_UPDATE").find(function(e){return e.name==="MessageStore"}),function(e){if(!o.storage.allAsVM||e[0].message.flags==8192)return;let t=e[0].message;t?.attachments?.[0]?.content_type?.startsWith("audio")&&(t.flags|=8192,t.attachments.forEach(function(n){n.waveform="AEtWPyUaGA4OEAcA",n.duration_secs=60}))})}const{FormRow:A}=m.Forms,d=i.findByProps("ActionSheetRow")?.ActionSheetRow;function g({label:e,icon:t,onPress:n}){const c=s.stylesheet.createThemedStyleSheet({iconComponent:{width:24,height:24,tintColor:R.semanticColors.INTERACTIVE_NORMAL}});return d?React.createElement(d,{label:e,icon:React.createElement(d.Icon,{source:t,IconComponent:function(){return React.createElement(s.ReactNative.Image,{resizeMode:"cover",style:c.iconComponent,source:t})}}),onPress:function(){return n?.()}}):React.createElement(A,{label:e,leading:React.createElement(A.Icon,{source:t}),onPress:function(){return n?.()}})}const P=i.findByProps("openLazy","hideActionSheet");function V(){return r.before("openLazy",P,function(e){const[t,n,c]=e,a=c?.message;n!=="MessageLongPressActionSheet"||!a||t.then(function(I){const D=r.after("default",I,function(U,y){s.React.useEffect(function(){return function(){D()}},[]);const f=S.findInReactTree(y,function(T){return T?.[0]?.type?.name==="ButtonRow"});if(!f)return y;a.hasFlag(8192)&&(f.splice(5,0,s.React.createElement(g,{label:"Download Voice Message",icon:l.getAssetIDByName("ic_download_24px"),onPress:async function(){await i.findByProps("downloadMediaAsset").downloadMediaAsset(a.attachments[0].url,0),i.findByProps("hideActionSheet").hideActionSheet()}})),f.splice(6,0,s.React.createElement(g,{label:"Copy Voice Message URL",icon:l.getAssetIDByName("copy"),onPress:async function(){s.clipboard.setString(a.attachments[0].url),i.findByProps("hideActionSheet").hideActionSheet()}})))})})})}const{FormDivider:b,FormIcon:h,FormSwitchRow:E}=m.Forms;function C(){return M.useProxy(o.storage),React.createElement(s.ReactNative.ScrollView,null,React.createElement(E,{label:"Send audio files as Voice Message",leading:React.createElement(h,{source:l.getAssetIDByName("voice_bar_mute_off")}),onValueChange:function(e){return o.storage.sendAsVM=e},value:o.storage.sendAsVM}),React.createElement(b,null),React.createElement(E,{label:"Show every audio file as a Voice Message",leading:React.createElement(h,{source:l.getAssetIDByName("ic_stage_music")}),onValueChange:function(e){return o.storage.allAsVM=e},value:o.storage.allAsVM}))}o.storage.sendAsVM??=!0,o.storage.allAsVM??=!1;const B=[_(),w(),v(),p(),V()],F=function(){B.forEach(function(e){return e()})};return u.onUnload=F,u.settings=C,u})({},vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.metro.common,vendetta.ui.assets,vendetta.utils,vendetta.ui,vendetta.ui.components,vendetta.storage);
